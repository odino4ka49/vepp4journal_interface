<!-- chat/templates/chat/index.html -->

{% load static %}
<!DOCTYPE html>
<html>
<head>
    <script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
    <meta charset="utf-8"/>
    <title>Vepp4 Journal</title>
</head>
<body>
    I'm Vepp4 Journal! Hello!<br/>
    <div id="stap_pvs"></div>

    <script>

        var pv_dict = {}

        function displayPvDict(){
            var list_div = $("#stap_pvs");
            console.log(list_div)
            list_div.empty();
            for(var pv in pv_dict){
                list_div.append($("<p>").append(pv+" "+pv_dict[pv]))
            }
        };

        var chatSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/vepp4journal/'
        );

        chatSocket.onmessage = function(e) {
            var data = JSON.parse(e.data);
            var message = data['message'];
            pv_dict[message.pv] = message.value;
            displayPvDict();
        };

        chatSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

    </script>
</body>
</html>
